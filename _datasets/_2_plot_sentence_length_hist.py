#!/usr/bin/env python3
from __future__ import annotations
"""Plot sentence-length histograms for IMDb and SMS spam datasets."""
"""Generated by GPT-5.1, 25/11/2025"""

from pathlib import Path
from typing import Optional

import matplotlib.pyplot as plt
from datasets import DatasetDict, load_dataset


OUTPUT_DIR = Path(__file__).resolve().parent / "figures"
OUTPUT_DIR.mkdir(parents=True, exist_ok=True)


def infer_text_key(ds_dict: DatasetDict, override: Optional[str]) -> str:
    """Return the column name that stores the raw text."""
    if override:
        return override
    first_split = next(iter(ds_dict.values()))
    for field, feature in first_split.features.items():
        if getattr(feature, "dtype", None) == "string":
            return field
    raise ValueError(f"Could not infer text column for dataset {ds_dict}")


def plot_hist_for_dataset(name: str, text_key: Optional[str] = None) -> None:
    """Load dataset splits and produce histogram figures for each of them."""
    ds_dict: DatasetDict = load_dataset(name)
    resolved_text_key = infer_text_key(ds_dict, text_key)
    for split_name, split in ds_dict.items():
        lengths = [len(str(text).split()) for text in split[resolved_text_key]]
        if not lengths:
            continue
        plt.figure(figsize=(8, 5))
        plt.hist(lengths, bins=50, color="#1f77b4", edgecolor="white")
        plt.title(f"{name} :: {split_name} sentence lengths")
        plt.xlabel("Sentence length (# tokens)")
        plt.ylabel("Count")
        plt.grid(axis="y", alpha=0.3)
        filename = f"{name.replace('/', '_')}_{split_name}_sentence_length_hist.png"
        path = OUTPUT_DIR / filename
        plt.tight_layout()
        plt.savefig(path)
        plt.close()
        print(f"Saved histogram to {path}")


def main() -> None:
    plot_hist_for_dataset("stanfordnlp/imdb", text_key="text")
    plot_hist_for_dataset("ucirvine/sms_spam")


if __name__ == "__main__":
    main()
